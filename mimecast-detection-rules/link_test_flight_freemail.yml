attack_types:
- Credential Phishing
description: Detects messages containing links to Apple TestFlight domains sent from
  free email providers, indicating potential service abuse of Apple's beta testing
  service.
detection_methods:
- Sender analysis
- URL analysis
id: 9b447f1f-4091-517d-a2b8-2a869aa46301
name: 'Link: Apple TestFlight from free email provider'
severity: medium
source: |-
  type.inbound
  and any(body.links,
           any(['testflight.apple.com'], ..href_url.query_params == strings.concat("domain=",.))
          or (
             strings.ends_with(.href_url.query_params,"mimecastprotect.com")
            and any(.href_url.query_params_decoded['domain'],
                    . in ("testflight.apple.com")
            )
          )
  )
  and not (
    (subject.is_forward or subject.is_reply)
    and (length(headers.references) != 0 or headers.in_reply_to is not null)
    and length(body.previous_threads) > 0
  )
  and (
    sender.email.domain.domain in $free_email_providers
    or beta.profile.by_reply_to().solicited == false
    or (
      beta.profile.by_reply_to().any_messages_malicious_or_spam
      and not beta.profile.by_reply_to().any_messages_benign
    )
  )
tactics_and_techniques:
- Free email provider
- Evasion
tags:
- Attack surface reduction
- Mimecast Hard to Fix
type: rule
