attack_types:
- Credential Phishing
description: This ASR rule detects the use of secure SharePoint links which require
  recipient verifcation before allowing access to the shared file. This has been observed
  as a method of evading automated analysis of the shared files' content.
detection_methods:
- Content analysis
- Sender analysis
id: 74ed3020-50f8-5237-8a4d-bd7665a815aa
name: 'Link: Secure SharePoint file share from new or unusual sender'
severity: low
source: |-
  type.inbound
  // SharePoint email indicators
  and strings.like(body.current_thread.text,
                   "*shared a file with you*",
                   "*shared with you*",
                   "*invited you to access a file*"
  )
  and strings.icontains(subject.subject, "shared")
  // the Sharepoint file has been "Protected"
  and any([body.plain.raw, body.current_thread.text],
          strings.icontains(.,
                            "This link only works for the direct recipients of this message"
          )
  )
  and any(body.links,  strings.ends_with(.href_url.query_params,"sharepoint.com") )

  // sender is uncommon
  and (
    profile.by_sender().prevalence in ("new", "rare", "outlier")
    // or the reply-to address has never sent an email to the org
    or profile.by_sender().prevalence in ("new")
  )
  and not profile.by_sender().solicited
tactics_and_techniques:
- Free file host
- Evasion
tags:
- Attack surface reduction
- Mimecast Changes Complete
type: rule
