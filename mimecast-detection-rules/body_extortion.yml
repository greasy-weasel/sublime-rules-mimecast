attack_types:
- Extortion
description: |-
  Detects extortion and sextortion attempts by analyzing the email body text from an untrusted sender.
detection_methods:
- Content analysis
- Header analysis
- Natural Language Understanding
- Sender analysis
id: 265913eb-2ccd-5f77-9a09-f6d8539fd2f6
name: Extortion / sextortion (untrusted sender)
references:
- https://krebsonsecurity.com/2018/07/sextortion-scam-uses-recipients-hacked-passwords/
severity: low
source: "type.inbound\nand length(filter(body.links, .display_text is not null)) <\
  \ 10\nand not (\n  ml.nlu_classifier(body.current_thread.text).language == \"english\"\
  \n  and any(ml.nlu_classifier(body.html.display_text).topics,\n          .name in\
  \ (\n            \"News and Current Events\",\n            \"Newsletters and Digests\"\
  ,\n            \"Advertising and Promotions\"\n          )\n          and .confidence\
  \ in (\"high\", \"medium\")\n  )\n)\nand (\n  (\n    any(ml.nlu_classifier(strings.replace_confusables(body.current_thread.text)).intents,\n\
  \        (.name == \"extortion\" and .confidence == \"high\")\n    )\n    and (\n\
  \      any(ml.nlu_classifier(strings.replace_confusables(body.current_thread.text\n\
  \                            )\n          ).entities,\n          .name == \"financial\"\
  \n          or (\n            .name is not null\n            and regex.icontains(.text,\n\
  \                                \"cyb\u1E1B[r\u0157\u0159\u1E59\u0211\u0213\u024D\
  \u0280\u027C\u027D\u0433]c[r\u0157\u0159\u1E59\u0211\u0213\u024D\u0280\u027C\u027D\
  \u0433]imina[l\u013A\u013C\u013E\u1E37\u1E39\u1E3D\u0142\u0196\u029F\u1E3B]s\"\n\
  \            )\n          )\n      )\n      or any(ml.nlu_classifier(strings.replace_confusables(body.current_thread.text\n\
  \                               )\n             ).topics,\n             .name ==\
  \ \"Financial Communications\" and .confidence != \"low\"\n      )\n    )\n  )\n\
  \  // manual indicators failsafe\n  or 3 of (\n    // malware terms\n    regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                    \"(?:(?:spy|[m\u1E41][a\u0201]l)[w\u0175][a\u0201][r\u0157\
  ]e|[t\u0162][r\u0157\u0213][o\u1ED1]j[a\u01FB][n\u0146]|[r\u0213]emote (?:entry|cont[r\u0159\
  ]o[l\u013A])|infiltrat(?:ed|ion)|backdoor|vi[r\u1E59]us|intruder|(?:your|the).{0,15}(?:device|system|computer|phone).{0,10}(?:became|was|got|is).{0,5}comprom[\u1E2F\
  i\xEF\xED\u012F\u012B]sed|prov[\u1E2Fi\xEF\xED\u012F\u012B]d[\u1E2Fi\xEF\xED\u012F\
  \u012B]ng.{0,20}full [a\u1EA3\u01E1\u0105]ccess)\"\n    ),\n    // actions recorded\n\
  \    regex.icontains(strings.replace_confusables(body.current_thread.text),\n  \
  \                  \"(?:p[o\u1ED9][r\u0157]n|a[d\u0221]ult (?:web)?site|webcam|mastu[r\u0157\
  ]bating|je[r\u0157]king off|pleasu[r\u0157\u0211]i[n\u014B]g you[r\u0157\u1E5B]self|getting\
  \ off|expli[c\u0188]it|cl[\u1E2Fi\xEF\xED\u012F\u012B]ps.{0,20}screenshots)\"\n\
  \    ),\n    regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                    \"(?:pe[r\u0157]ve[r\u0157]t|pe[r\u0157]ve[r\u0157]sion|mastu[r\u0157\
  ]bat)\"\n    ),\n    // a timeframe to pay\n    regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                    '[ilo0-9]{2} (?:hou[r\u0157\u1E5D][s\u1E63]|uu[r\u0157])',\n\
  \                    '(?:one|tw[o\u1EDD]|2|th[r\u0157]ee|\\d) [d\u1E0D][a\u1EA3\u01E1\
  \u0105]y[s\u1E63]?',\n                    'set a timer'\n    ),\n    // a promise\
  \ from the actor\n    regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                    '(?:pe[r\u0157]manently|will|I''ll) delete|([r\u0157]emove|destroy)\
  \ (?:[\\p{L}\\p{M}\\p{N}]+\\s*){0,4} (?:data|ev[\u1E2Fi\xEF\u012F\u012B\xED]dence|v[\u1E2F\
  i\xEF\xED\u012F\u012B]deos?)'\n    ),\n    // a threat from the actor\n    regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                    '(?:\\bsen[dt]|forward|expose)\\s*(?:[\\p{L}\\p{N}]+\\s*){0,5}\\\
  s*to\\s*(?:[\\p{L}\\p{N}]+\\s*){0,5}(?:contacts|media|family|f[r\u0157]iends|coworkers|associates)'\n\
  \    ),\n    // bitcoin language (excluding newsletters)\n    (\n      regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                      '[b\u1E06\u1E02]it[c\u0109\u0188][o\xF6\u0629]i[n\u0146\u0272\
  ]|\\bbtc\\b|blockchain'\n      )\n      // negate cryptocurrency newsletters\n \
  \     and not (\n        any(body.links,\n            strings.icontains(.display_text,\
  \ \"unsubscribe\")\n            and (\n              strings.icontains(.href_url.path,\
  \ \"unsubscribe\")\n              // handle mimecast URL rewrites\n            \
  \  or (\n                .href_url.domain.root_domain == 'mimecastprotect.com'\n\
  \                and strings.icontains(.href_url.query_params,\n               \
  \                       sender.email.domain.root_domain\n                )\n   \
  \           )\n            )\n        )\n      )\n    ),\n    (\n      regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                      '(?:contact the police|(?:bitcoin|\\bbtc\\b).{0,20}wallet)'\n\
  \      )\n      and regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                          '(?:\\b[13][a-km-zA-HJ-NP-Z0-9]{24,34}\\b)|\\bX[1-9A-HJ-NP-Za-km-z]{33}\\\
  b|\\b(?:0x[a-fA-F0-9]{40})\\b|\\b[LM3][a-km-zA-HJ-NP-Z1-9]{26,33}\\b|\\b[48][0-9AB][1-9A-HJ-NP-Za-km-z]{93}\\\
  b'\n      )\n    ),\n    regex.icontains(strings.replace_confusables(body.current_thread.text),\n\
  \                    'bc1q.{0,50}\\b'\n    )\n  )\n)\nand (\n  not profile.by_sender().solicited\n\
  \  or (\n    profile.by_sender().any_messages_malicious_or_spam\n    and not profile.by_sender().any_messages_benign\n\
  \  )\n  or any(headers.hops, any(.fields, .name == \"X-Google-Group-Id\"))\n\n \
  \ // many extortion emails spoof sender domains and fail sender authentication\n\
  \  or (\n    not headers.auth_summary.dmarc.pass\n    or headers.auth_summary.dmarc.pass\
  \ is null\n    or not headers.auth_summary.spf.pass\n  )\n)\n// negate legit bounce\
  \ backs\nand not any(ml.nlu_classifier(body.current_thread.text).topics,\n     \
  \       .name in (\"Bounce Back and Delivery Failure Notifications\")\n)\n// negate\
  \ legit forwards and replies\nand not (\n  (subject.is_reply or subject.is_forward)\n\
  \  and length(body.previous_threads) > 0\n  and (length(headers.references) > 0\
  \ or headers.in_reply_to is not null)\n)\n// negate benign newsletters that mention\
  \ cyber extortion\nand not (\n  any(body.links,\n      strings.icontains(.display_text,\
  \ \"unsubscribe\")\n      and strings.icontains(.href_url.path, \"unsubscribe\"\
  )\n  )\n  // newsletters are typically longer than the average extortion script\n\
  \  and length(body.current_thread.text) > 2000\n)\nand length(body.current_thread.text)\
  \ < 8000\n// negate TOS collisions from legal phrasing\nand not strings.icontains(body.current_thread.text,\
  \ \"terms of service\")\n// negate highly trusted sender domains unless they fail\
  \ DMARC authentication\nand (\n  (\n    sender.email.domain.root_domain in $high_trust_sender_root_domains\n\
  \    and not headers.auth_summary.dmarc.pass\n  )\n  or sender.email.domain.root_domain\
  \ not in $high_trust_sender_root_domains\n)"
tactics_and_techniques:
- Social engineering
- Spoofing
tags:
- Mimecast Hard to Fix
type: rule
